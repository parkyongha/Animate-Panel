<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <script>
        let localServer;
        const serverPath = `${__dirname}/server/main.js`;

        /**
         * ì‹¤ì œ ì„œë²„ ëª¨ë“ˆì„ require í•´ì„œ run()ì„ í˜¸ì¶œí•˜ê³ 
         * ìƒì„±ëœ httpServer ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
         */
        function createServerInstance() {
            // ìºì‹œì—ì„œ ì§€ì›Œì„œ í•­ìƒ ìµœì‹  ì½”ë“œë¥¼ ë¡œë“œ
            const resolved = cep_node.require.resolve(serverPath);
            delete cep_node.require.cache[resolved];

            // ëª¨ë“ˆ ê°€ì ¸ì™€ì„œ ì‹¤í–‰ â†’ httpServer ë°˜í™˜
            return cep_node.require(serverPath)();
        }

        /**
         * ì„œë²„ë¥¼ (ìž¬)ì‹œìž‘í•©ë‹ˆë‹¤.
         * ì´ì „ ì¸ìŠ¤í„´ìŠ¤ê°€ ìžˆìœ¼ë©´ ë‹«ì€ ë’¤, ì§§ì€ ë”œë ˆì´ë¥¼ ë‘ê³  ìƒˆë¡œ ë„ì›ë‹ˆë‹¤.
         */
        function reloadServer() {
            if (localServer) {
                localServer.close(() => {
                    console.log('ðŸ”’ Previous server closed');
                    // í¬íŠ¸ê°€ ì™„ì „ížˆ í•´ì œëœ í›„ì— ìƒˆë¡œ ì‹œìž‘
                    setTimeout(() => {
                        console.log('ðŸš€ Starting new server instance');
                        localServer = createServerInstance();
                    }, 100);
                });
            } else {
                console.log('ðŸš€ Initial server start');
                localServer = createServerInstance();
            }
        }

        // ìµœì´ˆ ì‹¤í–‰
        reloadServer();

    </script>
    <title>Import Example App</title>
</head>

<body>
    <h1>Local Server Test</h1>
</body>

</html>